{{ $albumName := .Get 0 }}
{{ $width := .Get 1 | default "70%" }}
{{ $albumPath := print "static/myimgs/" $albumName }}
{{ $images := readDir $albumPath }}
{{ $imageURLs := slice }}

{{ range $images }}
{{ if and (not .IsDir) (ne .Name ".DS_Store") }}
  {{ $imageURLs = $imageURLs | append .Name }}
{{ end }}
{{ end }}

<center>
  <figure>
    {{ range $imageURLs }}
      <img src="{{ print "myimgs/" $albumName "/" . | relURL }}" style="width:{{ $width }}; margin: 5px; cursor: pointer;" class="album-image" />
    {{ end }}
    <button id="photo-viewer-btn" style="margin-top: 10px;">Enter Photo Viewer</button>
  </figure>
</center>

<div id="photo-viewer" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgb(15, 30, 34); z-index: 9999;">
  <img id="photo-viewer-img" style="max-width: 100%; max-height: 100%; margin: auto; position: absolute; top: 0; left: 0; right: 0; bottom: 0;" />
  <button id="photo-viewer-close" style="position: absolute; top: 10px; right: 10px; background-color: #cbc876; color:aliceblue; border: none; cursor: pointer; z-index: 10000;">Close</button>
</div>

<script>
  const albumName = "{{ $albumName }}";
  const images = {{ $imageURLs }};
  let currentIndex = 0;

  const photoViewer = document.getElementById('photo-viewer');
  const photoViewerImg = document.getElementById('photo-viewer-img');
  const closeBtn = document.getElementById('photo-viewer-close');
  const photoViewerBtn = document.getElementById('photo-viewer-btn');

  function showImage(index) {
    if (index >= 0 && index < images.length) {
      currentIndex = index;
      photoViewerImg.src = `/myimgs/${albumName}/${images[currentIndex]}`;
    }
  }

  photoViewerBtn.addEventListener('click', () => {
    photoViewer.style.display = 'block';
    showImage(0);
  });

  closeBtn.addEventListener('click', () => {
    photoViewer.style.display = 'none';
  });

  document.addEventListener('keydown', (event) => {
    if (photoViewer.style.display === 'block') {
      if (event.key === 'ArrowRight') {
        showImage((currentIndex + 1) % images.length);
      } else if (event.key === 'ArrowLeft') {
        showImage((currentIndex - 1 + images.length) % images.length);
      } else if (event.key === 'Escape') {
        photoViewer.style.display = 'none';
      }
    }
  });

  document.querySelectorAll('.album-image').forEach((img, index) => {
    img.addEventListener('click', () => {
      photoViewer.style.display = 'block';
      showImage(index);
    });
  });
</script>
